# Ultralytics ğŸš€ AGPL-3.0 License - https://ultralytics.com/license

# Ultralytics YOLOv8 object detection model with MTI_Block & TemporalSlice
# Based on YOLOv8n

# Parameters
nc: 80 # number of classes
scales: # model compound scaling constants
  # [depth, width, max_channels]
  n: [0.33, 0.25, 1024]
  s: [0.33, 0.50, 1024]
  m: [0.67, 0.75, 768]
  l: [1.00, 1.00, 512]
  x: [1.00, 1.25, 512]

# YOLOv8.0n backbone (ä¿æŒä¸å˜)
backbone:
  # [from, repeats, module, args]
  - [-1, 1, Conv, [64, 3, 2]] # 0-P1/2
  - [-1, 1, Conv, [128, 3, 2]] # 1-P2/4
  - [-1, 3, C2f, [128, True]]
  - [-1, 1, Conv, [256, 3, 2]] # 3-P3/8
  - [-1, 6, C2f, [256, True]] # 4 (Backbone P3)
  - [-1, 1, Conv, [512, 3, 2]] # 5-P4/16
  - [-1, 6, C2f, [512, True]] # 6 (Backbone P4)
  - [-1, 1, Conv, [1024, 3, 2]] # 7-P5/32
  - [-1, 3, C2f, [1024, True]]
  - [-1, 1, SPPF, [1024, 5]] # 9 (Backbone P5)

# YOLOv8.0n head (æ·»åŠ  MTI å’Œ TemporalSlice)
head:
  # --------------------------------------------------------
  # Step 1: é¢„å¤„ç† Backbone çš„ä¸‰ä¸ªè¾“å‡ºå±‚
  # --------------------------------------------------------
  - [-1, 1, MTI_Block, [1024, 5, 8]] # 10: å¤„ç† Backbone P5 (æ¥è‡ª Layer 9)
  # - [-1, 1, TemporalSlice, [5]]    # 10: å¤„ç† Backbone P5 (æ¥è‡ª Layer 9)
  - [6, 1, MTI_Block, [512, 5, 4]] # 11: å¤„ç† Backbone P4 (æ¥è‡ª Layer 6)
  - [4, 1, TemporalSlice, [5]]     # 12: å¤„ç† Backbone P3 (æ¥è‡ª Layer 4)

  # --------------------------------------------------------
  # Step 2: FPN (Top-down)
  # --------------------------------------------------------
  - [10, 1, nn.Upsample, [None, 2, "nearest"]] # 13: ä¸Šé‡‡æ · P5 (æ³¨æ„æ¥æºæ˜¯ 10)
  - [[-1, 11], 1, Concat, [1]]             # 14: Cat ä¸Šé‡‡æ ·åçš„P5 + å¤„ç†åçš„P4 (11)
  - [-1, 3, C2f, [512]]                     # 15

  - [-1, 1, nn.Upsample, [None, 2, "nearest"]] # 16: ä¸Šé‡‡æ · P4
  - [[-1, 12], 1, Concat, [1]]             # 17: Cat ä¸Šé‡‡æ ·åçš„P4 + å¤„ç†åçš„P3 (12)
  - [-1, 3, C2f, [256]]                     # 18 (Head P3/8-small)

  # --------------------------------------------------------
  # Step 3: PAN (Bottom-up)
  # --------------------------------------------------------
  - [-1, 1, Conv, [256, 3, 2]]             # 19: ä¸‹é‡‡æ ·
  - [[-1, 15], 1, Concat, [1]]             # 20: Cat Head P4 (Layer 15)
  - [-1, 3, C2f, [512]]                     # 21 (Head P4/16-medium)

  - [-1, 1, Conv, [512, 3, 2]]             # 22: ä¸‹é‡‡æ ·
  - [[-1, 10], 1, Concat, [1]]             # 23: Cat å¤„ç†åçš„P5 (Layer 10)
  - [-1, 3, C2f, [1024]]                    # 24 (Head P5/32-large)

  # --------------------------------------------------------
  # Step 4: Detect
  # --------------------------------------------------------
  - [[18, 21, 24], 1, Detect, [nc]] # Detect(P3, P4, P5)